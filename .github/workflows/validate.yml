name: Validate Update Notes

on:
  push:
    branches: [ main ]
    paths:
      - 'update-notes.json'
  pull_request:
    branches: [ main ]
    paths:
      - 'update-notes.json'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Validate JSON syntax
      run: |
        python -m json.tool update-notes.json > /dev/null
        echo "‚úÖ JSON syntax is valid"

    - name: Check required fields
      run: |
        python3 -c "
        import json
        import sys

        with open('update-notes.json', 'r') as f:
            data = json.load(f)

        # Check required fields
        required = ['version', 'items']
        for field in required:
            if field not in data:
                print(f'‚ùå Missing required field: {field}')
                sys.exit(1)

        # Check items
        if not data['items']:
            print('‚ùå Items array is empty')
            sys.exit(1)

        for i, item in enumerate(data['items']):
            required_item_fields = ['icon', 'title', 'description']
            for field in required_item_fields:
                if field not in item:
                    print(f'‚ùå Item {i} missing field: {field}')
                    sys.exit(1)

        print(f'‚úÖ Valid update notes with {len(data[\"items\"])} items')
        print(f'üì¶ Version: {data[\"version\"]}')
        "

    - name: Check file size
      run: |
        size=$(stat -c%s update-notes.json)
        if [ $size -gt 50000 ]; then
          echo "‚ö†Ô∏è Warning: File size is large (${size} bytes). Consider reducing content."
        else
          echo "‚úÖ File size is reasonable (${size} bytes)"
        fi